"use strict";!function(c){var u={form:{beforeSubmit:function(e){var a=e.find('.pum-field-submit input[type="submit"]'),t=e.find(".pum-upgrade-messages"),r=e.find(".pum-batch-progress"),s=e.data("ays");return!a.hasClass("button-disabled")&&(!(void 0!==s&&!confirm(s))&&(r.removeClass("pum-batch-progress--active"),r.find("progress").prop("value",null),t.html(""),a.addClass("button-disabled"),c('<span class="spinner is-active"></span>').insertAfter(a),!0))}},complete:function(e){var a=e.parents(".notice");e.find(".pum-field-submit, progress").hide(),c("p.pum-upgrade-notice").hide(),a.removeClass("notice-info").addClass("notice-success  notice-alt"),a.prepend("<h2>"+pum_batch_vars.complete+"</h2>")},action:"pum_process_batch_request",process_step:function(e,n){var i=this;c.ajax({type:"POST",url:ajaxurl,data:{batch_id:n.batch_id,action:i.action,nonce:n.nonce,form:n.form,step:parseInt(e),data:n},dataType:"json",success:function(e){if(e.data.done||e.data.error){var a=e.data.mapping?".pum-batch-import-form":".pum-batch-form",t=c(a),r=t.find(".spinner"),s=t.find(".notice-wrap");t.find(".button-disabled").removeClass("button-disabled"),e.data.error?(r.remove(),s.html('<div class="updated error"><p>'+e.data.error+"</p></div>")):e.data.done?(r.remove(),s.html('<div id="pum-batch-success" class="updated notice"><p class="pum-batch-success">'+e.data.message+"</p></div>"),e.data.url&&(window.location=e.data.url)):s.remove()}else c(".pum-batch-progress div").animate({width:e.data.percentage+"%"},50),i.process_step(e.data.step,n)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}},a=c.extend({},u,{action:"pum_process_batch_import",before_submit:function(e,a){var t=c(".pum-batch-import-form").find(".pum-batch-progress").parent().parent(),r=t.find(".notice-wrap");if(a.find(".notice-wrap").remove(),a.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="pum-batch-progress"><div></div>'),!(window.File&&window.FileReader&&window.FileList&&window.Blob))return t.find(".button-disabled").removeClass("button-disabled"),r.html('<div class="update error"><p>'+pum_batch_vars.unsupported_browser+"</p></div>"),!1},success:function(e,a,t,r){console.log(r)},complete:function(e){var i=jQuery.parseJSON(e.responseText);if(i.success){var o,s,n,d=c(".pum-batch-import-form .notice-wrap").parent(),a=d.find("select.pum-import-csv-column"),p="",t=i.data.columns.sort(function(e,a){return e<a?-1:a<e?1:0});d.find(".pum-import-file-wrap, .notice-wrap").remove(),d.find(".pum-import-options").slideDown(),c.each(a,function(e,a){var n=c(this);o=c(a).attr("name"),c.each(t,function(e,a){var t=a.toLowerCase().replace(/ /g,"_"),r=new RegExp("\\["+t+"\\]"),s=!(!o.length||!o.match(r))&&' selected="selected"';s&&n.parent().next().html(!1!==i.data.first_row[a]?i.data.first_row[a]:""),p+='<option value="'+a+'"'+s+">"+a+"</option>"}),n.append(p),p=""}),a.on("change",function(){var e=c(this),a=e.val(),t="";a&&!1!==i.data.first_row[a]&&(t=i.data.first_row[a]),e.parent().next().html(t)}),c("body").on("click",".pum-import-proceed",function(e){if(e.preventDefault(),d.data("required")){var a=d.data("required"),t=[];t=a.indexOf(",")?a.split(","):[a];var r=!1;if(c.each(t,function(e,a){s=c("select[name='pum-import-field["+a+"]']"),(n=s.parent().parent()).removeClass("pum-required-import-field"),""===s.val()&&(r=!0,n.addClass("pum-required-import-field"),s.parent().next().html(pum_batch_vars.import_field_required))}),r)return}d.find(".notice-wrap").remove(),c(this).parent().append('<span class="spinner is-active"></span>'),d.append('<div class="notice-wrap"><div class="pum-batch-progress"><div></div>'),i.data.mapping=d.serialize(),i.data.form=d.serializeAssoc(),u.process_step(1,i.data)})}else this.error(e)},error:function(e){var a=jQuery.parseJSON(e.responseText),t=c(".pum-batch-import-form").find(".pum-batch-progress").parent().parent(),r=t.find(".notice-wrap");t.find(".button-disabled").removeClass("button-disabled"),a.data.error?r.html('<div class="update error"><p>'+a.data.error+"</p></div>"):r.remove()}}),r=c.extend(!0,{},u,{action:"pum_process_upgrade_request",process_step:function(e,n){var i=this;c.ajax({type:"POST",url:ajaxurl,data:{upgrade_id:n.upgrade_id,action:i.action,nonce:n.nonce,form:n.form,step:parseInt(e),data:n},dataType:"json",success:function(e){var a=c(".pum-upgrade-form"),t=a.find(".spinner"),r=a.find(".button-disabled"),s=a.find(".pum-upgrade-messages");e.data.done||e.data.error?(r.removeClass("button-disabled"),e.data.error?(t.remove(),s.prepend('<div class="notice notice-error notice-alt"><p>'+e.data.error+"</p></div>")):e.data.done?(s.prepend('<div class="notice notice-success"><p><strong>'+e.data.message+"</strong></p></div>"),e.data.next?(a.data("upgrade_id",e.data.next).data("step",1).data("ays",!1),i.process_step(1,{upgrade_id:e.data.next,nonce:n.nonce,form:n.form})):(r.parent().hide(),t.remove(),u.complete(a)),e.data.url&&(window.location=e.data.url)):""!==e.data.message&&s.prepend('<div class="notice"><p class="">'+e.data.message+"</p></div>")):(""!==e.data.message&&s.prepend('<div class="notice"><p class="">'+e.data.message+"</p></div>"),c(".pum-batch-progress").addClass("pum-batch-progress--active"),c(".pum-batch-progress progress.pum-task-progress").addClass("active").val(e.data.percentage),i.process_step(e.data.step,n))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}});window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.batch=u,window.PUM_Admin.batch_import=a,window.PUM_Admin.batch_upgrades=r,c(document).on("submit",".pum-batch-form[data-batch_id]",function(e){var a=c(this),t=a.find('input[type="submit"]'),r=a.data("ays"),s={batch_id:a.data("batch_id"),nonce:a.data("nonce"),form:a.serializeAssoc(),test:a.pumSerializeObject()};if(e.preventDefault(),!t.hasClass("button-disabled")){if(void 0!==r&&!confirm(r))return;a.find(".notice-wrap").remove(),a.append(c('<div class="notice-wrap"><div class="pum-batch-progress"><div></div>')),t.addClass("button-disabled"),t.parent().append('<span class="spinner is-active"></span>'),u.process_step(1,s)}}).on("submit",".pum-batch-form.pum-upgrade-form[data-upgrade_id]",function(e){var a=c(this),t={upgrade_id:a.data("upgrade_id"),nonce:a.data("nonce"),form:a.serializeAssoc(),test:a.pumSerializeObject()};e.preventDefault(),r.form.beforeSubmit(a)&&r.process_step(a.data("step")||1,t)}).ready(function(){c(".pum-batch-import-form").each(function(){var e=c(this);e.ajaxForm({beforeSubmit:a.before_submit,complete:a.complete,dataType:"json",error:a.error,data:{action:a.action,batch_id:e.data("batch_id"),nonce:e.data("nonce")},url:ajaxurl,resetForm:!0})})})}(jQuery),jQuery(document).ready(function(o){o.extend({arrayMerge:function(){for(var e={},a=0,t=o.arrayMerge.arguments,r=0;r<t.length;r++)if(Array.isArray(t[r])){for(var s=0;s<t[r].length;s++)e[a++]=t[r][s];e=o.makeArray(e)}else for(var n in t[r])if(t[r].hasOwnProperty(n))if(isNaN(n)){var i=t[r][n];"object"==typeof i&&e[n]&&(i=o.arrayMerge(e[n],i)),e[n]=i}else e[a++]=t[r][n];return e},count:function(e){return Array.isArray(e)?e.length:"object"==typeof e&&Object.keys(e).length}}),o.fn.extend({serializeAssoc:function(){for(var e={aa:{},add:function(e,a){var t=e.match(/^(.*)\[([^\]]*)]$/),r={};t?(t[2]?r[t[2]]=a:r[o.count(r)]=a,this.add(t[1],r)):this.aa[e]="object"==typeof a?("object"!=typeof this.aa[e]&&(this.aa[e]={}),o.arrayMerge(this.aa[e],a)):a}},a=o(this).serializeArray(),t=0;t<a.length;t++)e.add(a[t].name,a[t].value);return e.aa}})});