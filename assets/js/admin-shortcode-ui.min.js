!function(t){"use strict";var e=pum_admin_vars.I10n||pum_shortcode_ui.I10n||{error_loading_shortcode_preview:"",insert:"",update:""},o=pum_shortcode_ui.shortcodes||{},n={shortcode_args:{},shortcode_data:{},initialize:function(t){},cleanAttrs:function(t){return _.each(t,function(e,o){null!==e&&""!==e||delete t[o],"object"==typeof e&&(t[o]=Object.keys(e))}),t},template:function(e){var o,n=t("#tmpl-pum-shortcode-view-"+this.type),s={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"attr"};return n.length?(o=_.template(n.html(),null,s),e["class"]&&(e.classes=e["class"],delete e["class"]),e=this.cleanAttrs(e),o(e)):this.text},getShortcodeValues:function(){return"undefined"==typeof this.shortcode||"undefined"==typeof this.shortcode.attrs?{}:_.extend({},this.shortcode.attrs.named||{})},getShortcodeContent:function(){return"undefined"==typeof this.shortcode?"":this.shortcode.content||""},getContent:function(){return this.content||this.fetch(),this.content},formatShortcode:function(t){var e=this.shortcode_args.has_content,o=this.getShortcodeContent();return t=t||this.getShortcodeValues(),e&&"undefined"!=typeof t._inner_content&&(o=t._inner_content,delete t._inner_content),t=this.cleanAttrs(t),PUM_Templates.shortcode({tag:this.type,meta:t,has_content:e,content:o})},fetch:function(){var o=this;if(!this.fetching){this.fetching=!0;var n=t("#tmpl-pum-shortcode-view-"+this.type),s=this.getShortcodeValues(),i={};this.shortcode_args.has_content&&(s._inner_content=this.getShortcodeContent()),!this.shortcode_args.ajax_rendering&&n.length?(this.content=this.template(s),delete this.fetching,this.render()):(i={action:"pum_do_shortcode",post_id:t("#post_ID").val(),tag:this.type,shortcode:this.formatShortcode(),nonce:'<?php echo wp_create_nonce( "pum-shortcode-ui-nonce" ); ?>'},t.post(ajaxurl,i).done(function(t){o.content=t.data}).fail(function(){o.content='<span class="pum_shortcode_ui_error">'+e.error_loading_shortcode_preview+"</span>"}).always(function(){delete o.fetching,o.render()}))}},edit:function(t,e){var o=_.extend({},this.getShortcodeValues());this.shortcode_args.has_content&&(o._inner_content=this.getShortcodeContent()),this.renderForm(o,e)},setLoader:function(){this.setContent('<div class="loading-placeholder"><div class="dashicons dashicons-admin-generic"></div><div class="wpview-loading"><ins></ins></div></div>')},renderForm:function(o,n){var s,i,c=this,r=(tinyMCE.activeEditor,{}),d={},a=t.extend(!0,{},{tag:this.type,id:"pum-shortcode-editor-"+this.type,label:"",fields:{}},c.shortcode_args);void 0===o&&(o={}),_.each(a.fields,function(t,e){void 0===d[e]&&(d[e]=[]),_.each(t,function(t,n){i=t,void 0!==o[t.id]&&(i.value=o[t.id]),i.id="pum_shortcode_attrs_"+i.id,d[e].push(PUM_Templates.field(i))}),d[e]=PUM_Templates.section({fields:d[e]})}),_.each(d,function(t,e){r[e]={label:a.sections[e],content:t}}),r=PUM_Templates.tabs({id:a.id,classes:"",tabs:r}),s=PUM_Templates.modal({id:a.id,title:a.label,description:a.description,save_button:void 0===o?e.insert:e.update,classes:"tabbed-content pum-shortcode-editor",content:r,meta:{"data-shortcode_tag":this.type}}),PUM_Admin.modals.reload("#"+a.id,s,function(){var e=t("#"+a.id);e.find(".pum-form").submit(function(o){o.preventDefault();var s=t(this),i=s.pumSerializeObject(),r=c.formatShortcode(i.attrs);n(r),PUM_Admin.modals.closeAll(function(){t(e).remove()})})})}};t(document).ready(function(){wp.mce=wp.mce||{},wp.mce.pum_shortcodes=wp.pum_shortcodes||{},t.each(o,function(e,o){var s=_.extend({},n,{shortcode_args:o,View:{type:e,template:function(t){return wp.mce.pum_shortcodes[this.type].template(t)},postID:t("#post_ID").val(),initialize:function(t){this.shortcode=t.shortcode,wp.mce.pum_shortcodes[this.type].shortcode_data=this.shortcode},getHtml:function(){var t=this.shortcode.attrs.named;return this.shortcode_args.has_content&&(t._inner_content=this.shortcode.content),this.template(t)}}});wp.mce.pum_shortcodes[e]=s,void 0!==wp.mce.views&&"function"===wp.mce.views.register&&wp.mce.views.register(e,s)})})}(jQuery);