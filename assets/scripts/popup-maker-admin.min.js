var PopMakeAdmin; (function(){PopMakeAdmin={init:function(){PopMakeAdmin.initialize_tabs();jQuery("body.post-type-popup form#post").length&&(PopMakeAdmin.initialize_popup_page(),PopMakeAdmin.attachQuickSearchListeners(),PopMakeAdmin.attachTabsPanelListeners());jQuery("body.post-type-popup_theme form#post").length&&PopMakeAdmin.initialize_theme_page();PopMakeAdmin.initialize_color_pickers();PopMakeAdmin.initialize_range_sliders();jQuery(document).keydown(function(a){return"115"!==a.which&&"83"!==a.which||!a.ctrlKey&& !a.metaKey?!0:(a.preventDefault(),jQuery("#popmake-theme-editor, #popmake-popup-editor, body.post-type-popup form#post, body.post-type-popup_theme form#post").submit(),!1)})},attachTabsPanelListeners:function(){jQuery("#poststuff").bind("click",function(a){var c,b,e=jQuery(a.target),f,d,g,h,k,n;if(e.hasClass("nav-tab-link"))c=e.data("type"),b=e.parents(".posttypediv, .taxonomydiv").first(),jQuery("input",b).removeAttr("checked"),jQuery(".tabs-panel-active",b).removeClass("tabs-panel-active").addClass("tabs-panel-inactive"), jQuery("#"+c,b).removeClass("tabs-panel-inactive").addClass("tabs-panel-active"),jQuery(".tabs",b).removeClass("tabs"),e.parent().addClass("tabs"),jQuery(".quick-search",b).focus(),a.preventDefault();else if(e.hasClass("select-all"))(a=/#(.*)$/.exec(a.target.href))&&a[1]&&(a=jQuery("#"+a[1]+" .tabs-panel-active .menu-item-title input"),a.length===a.filter(":checked").length?a.removeAttr("checked"):a.prop("checked",!0));else if(e.hasClass("submit-add-to-menu")){b=e.parents(".options");a=jQuery('.tabs-panel-active input[type="checkbox"]:checked', b);c=jQuery("textarea",b);f=jQuery(".tagchecklist",b);d=c.val().split(",");for(b=0;b<d.length;b+=1)d[b]=parseInt(d[b],10);a.each(function(){g=jQuery(this);h=parseInt(g.val(),10);k=g.parent("label").siblings(".menu-item-title").val();-1===jQuery.inArray(h,d)&&d.push(h);f.append('<span><a class="ntdelbutton" data-id="'+h+'">X</a> '+k+"</span>")});c.text(d.join(","))}else e.hasClass("ntdelbutton")&&(g=e,n=parseInt(g.data("id"),10),b=e.parents(".options"),c=jQuery("textarea",b),f=jQuery(".tagchecklist", b),d=c.val().split(","),d=jQuery.grep(d,function(a){return a!==n}),g.parent("span").remove(),c.text(d.join(",")))})},attachQuickSearchListeners:function(){var a;jQuery(".quick-search").keypress(function(c){var b=jQuery(this);if(13===c.which)return PopMakeAdmin.updateQuickSearchResults(b),!1;a&&clearTimeout(a);a=setTimeout(function(){PopMakeAdmin.updateQuickSearchResults(b)},400)}).attr("autocomplete","off")},updateQuickSearchResults:function(a){var c,b,e=a.val();2>e.length||(c=a.parents(".tabs-panel"), b={action:"menu-quick-search","response-format":"markup",menu:null,"menu-settings-column-nonce":jQuery("#menu-settings-column-nonce").val(),q:e,type:a.attr("name")},jQuery(".spinner",c).show(),jQuery.post(ajaxurl,b,function(a){PopMakeAdmin.processQuickSearchQueryResponse(a,b,c)}))},processQuickSearchQueryResponse:function(a,c,b){var e,f,d=jQuery("form#post"),g={},h=/menu-item[(\[\^]\]*/;a=jQuery("<div>").html(a).find("li");var k;a.length?(a.each(function(){k=jQuery(this);if((e=h.exec(k.html()))&& e[1]){for(f=e[1];d.elements["menu-item["+f+"][menu-item-type]"]||g[f];)--f;g[f]=!0;f!==e[1]&&k.html(k.html().replace(new RegExp("menu-item\\["+e[1]+"\\]","g"),"menu-item["+f+"]"))}}),jQuery(".categorychecklist",b).html(a),jQuery(".spinner",b).hide(),jQuery('[name^="menu-item"]').removeAttr("name")):(jQuery(".categorychecklist",b).html("<li><p>noResultsFound</p></li>"),jQuery(".spinner",b).hide())},initialize_color_pickers:function(){var a=this;jQuery(".color-picker").wpColorPicker({clear:function(c){a.update_theme(); c=jQuery(c.currentTarget).prev();c.hasClass("background-color")&&c.parents("table").find(".background-opacity").hide()}})},initialize_range_sliders:function(){var a,c,b,e,f,d=jQuery('<input type="range"/>'),g=jQuery('<button class="popmake-range-plus">+</button>'),h=jQuery('<button class="popmake-range-minus">-</button>');jQuery(document).on("input",'input[type="range"]',function(){var a=jQuery(this);a.siblings(".popmake-range-manual").val(a.val())});jQuery(".popmake-range-manual").each(function(){var a= jQuery(this),c=a.data("force-minmax"),p=parseInt(a.prop("min"),0),m=parseInt(a.prop("max"),0),q=parseInt(a.prop("step"),0),l=parseInt(a.val(),0);b=d.clone();e=g.clone();f=h.clone();c&&l>m&&(l=m,a.val(l));b.prop({min:p||0,max:c||m&&m>l?m:1.5*l,step:q||1.5*l/100,value:l}).on("change input",function(){a.trigger("input")});a.next().after(f,e);a.before(b)});jQuery(document).on("click",".popmake-range-manual",function(){jQuery(this).removeProp("readonly")}).on("focusout",".popmake-range-manual",function(){jQuery(this).prop("readonly", !0)}).on("change",".popmake-range-manual",function(){var a=jQuery(this),d=parseInt(a.prop("max"),0),c=parseInt(a.prop("step"),0),g=a.data("force-minmax"),e=parseInt(a.val(),0);b=a.prev();g&&e>d&&(e=d,a.val(e));b.prop({max:g||d&&d>e?d:1.5*e,step:c||1.5*e/100,value:e})}).on("click",".popmake-range-plus",function(a){a.preventDefault();a=jQuery(this).siblings(".popmake-range-manual");var d=parseInt(a.prop("step"),0),d=parseInt(a.val(),0)+d;b=a.prev();a.val(d).trigger("input");b.val(d)}).on("click",".popmake-range-minus", function(a){a.preventDefault();a=jQuery(this).siblings(".popmake-range-manual");var d=parseInt(a.prop("step"),0),d=parseInt(a.val(),0)-d;b=a.prev();a.val(d).trigger("input");b.val(d)});a=document.createElement("input");a.setAttribute("type","range");"text"===a.type&&jQuery("input[type=range]").each(function(a,d){c=jQuery(d);b=jQuery("<div />").slider({min:parseInt(c.attr("min"),10)||0,max:parseInt(c.attr("max"),10)||100,value:parseInt(c.attr("value"),10)||0,step:parseInt(c.attr("step"),10)||1,slide:function(a, d){jQuery(this).prev("input").val(d.value)}});c.after(b).hide()})},initialize_tabs:function(){var a=window.location.hash;""===a&&(a="#"+jQuery(".popmake-tab-content").eq(0).attr("id"));jQuery(".popmake-tab-content").hide();jQuery(a).show();jQuery(a+"-tab").addClass("nav-tab-active");jQuery(window).scrollTop(0);jQuery("#popmake-tabs .nav-tab").click(function(a){a.preventDefault();jQuery(".popmake-tab-content").hide();jQuery(".popmake-tab").removeClass("nav-tab-active");a=jQuery(this).attr("href"); jQuery(a).show();jQuery(this).addClass("nav-tab-active");history.pushState?history.pushState(null,null,a):(location.hash=a,jQuery(window).scrollTop(0))})},initialize_popup_page:function(){var a=function(a){var b=a.siblings(".options");a.is(":checked")?(b.show(),"popup_loading_condition_on_entire_site"===a.attr("id")?(b=a.parents("#popmake_popup_loading_condition_fields").find('[id^="loading_condition-exclude_on_"]'),a=a.parents(".loading_condition").siblings(".loading_condition"),a.hide(),jQuery("> *", a).prop("disabled",!0),b.show(),jQuery("> *",b).removeProp("disabled")):jQuery("*",b).removeProp("disabled")):(b.hide(),"popup_loading_condition_on_entire_site"===a.attr("id")?(b=a.parents("#popmake_popup_loading_condition_fields").find('[id^="loading_condition-exclude_on_"]'),a=a.parents(".loading_condition").siblings(".loading_condition"),a.show(),jQuery("> *",a).removeProp("disabled"),b.hide(),jQuery("> *",b).prop("disabled",!0)):jQuery("*",b).prop("disabled",!0))},c=function(a){var b=a.parent().siblings('input[type="checkbox"]:first'), c=0<=b.attr("name").indexOf("exclude"),e=c?b.attr("name").replace("popup_loading_condition_exclude_on_specific_",""):b.attr("name").replace("popup_loading_condition_on_specific_",""),c=c?jQuery("#exclude_on_specific_"+e):jQuery("#on_specific_"+e);a.is(":checked")&&("true"===a.val()?(b.prop("checked",!0),c.show(),jQuery("*",c).removeProp("disabled")):""===a.val()&&(b.removeProp("checked"),c.hide(),jQuery("*",c).prop("disabled",!0)))},b=function(){"custom"!==jQuery("#popup_display_size").val()?jQuery(".custom-size-only").hide(): (jQuery(".custom-size-only").show(),jQuery("#popup_display_custom_height_auto").is(":checked")?jQuery(".custom-size-height-only").hide():jQuery(".custom-size-height-only").show())},e=function(){jQuery(".animation-speed, .animation-origin").hide();"fade"===jQuery("#popup_display_animation_type").val()?jQuery(".animation-speed").show():"none"!==jQuery("#popup_display_animation_type").val()&&jQuery(".animation-speed, .animation-origin").show()},f=function(){var a=jQuery("#popup_display_location"),b= a.parents("table"),a=a.val();jQuery("tr.top, tr.right, tr.left, tr.bottom",b).hide();0<=a.indexOf("top")&&jQuery("tr.top").show();0<=a.indexOf("left")&&jQuery("tr.left").show();0<=a.indexOf("bottom")&&jQuery("tr.bottom").show();0<=a.indexOf("right")&&jQuery("tr.right").show()};jQuery("#popuptitlediv").insertAfter("#titlediv");jQuery('[name^="menu-item"]').removeAttr("name");jQuery(document).on("keydown","#popuptitle",function(a){9===(a.keyCode||a.which)&&(a.preventDefault(),jQuery("#title").focus())}).on("keydown", "#title, #popuptitle",function(a){var b=a.keyCode||a.which;a.shiftKey||9!==b||(a.preventDefault(),a="title"===jQuery(this).attr("id")?"#popuptitle":"#insert-media-button",jQuery(a).focus())}).on("keydown","#popuptitle, #insert-media-button",function(a){var b=a.keyCode||a.which;a.shiftKey&&9===b&&(a.preventDefault(),a="popuptitle"===jQuery(this).attr("id")?"#title":"#popuptitle",jQuery(a).focus())}).on("submit","#post",function(a){var b=jQuery("#title").val();if(0===b.length||0===b.replace(/\s/g,"").length)a.preventDefault(), jQuery("div#notice").remove(),jQuery("<div id='notice' class='error below-h2'><p>A name is required for all popups.</p></div>").insertAfter("h2"),jQuery("#title").focus(),jQuery("#ajax-loading").hide(),jQuery("#publish").removeClass("button-primary-disabled"),jQuery("#title").prop("required","required")}).on("change","#popup_display_size",function(){b()}).on("click","#popup_display_custom_height_auto",function(){b()}).on("change","#popup_display_animation_type",function(){e()}).on("change","#popup_display_location", function(){f()});jQuery('#popmake_popup_loading_condition_fields .loading_condition > input[type="checkbox"]').on("click",function(){a(jQuery(this))}).each(function(){a(jQuery(this))});jQuery('input[type="radio"][name*="radio_checkbox_"]').on("click",function(){c(jQuery(this))}).each(function(){c(jQuery(this))});jQuery(".posttypediv, .taxonomydiv").each(function(){var a=jQuery(this),b=jQuery("> ul li"),a=jQuery(".tabs-panel",a);b.removeClass("tabs");b.eq(0).addClass("tabs");a.removeClass("tabs-panel-active").addClass("tabs-panel-inactive").removeAttr("style"); a.eq(0).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});b();e();f()},theme_page_listeners:function(){var a=this;jQuery(document).on("change input focusout","select, input:not(.color-picker)",function(){a.update_theme()}).on("change","select.border-style",function(){var a=jQuery(this);"none"===a.val()?a.parents("table").find(".border-options").hide():a.parents("table").find(".border-options").show()}).on("change","#popup_theme_close_location",function(){var a=jQuery(this),b=a.parents("table"); jQuery("tr.topleft, tr.topright, tr.bottomleft, tr.bottomright",b).hide();jQuery("tr."+a.val(),b).show()}).on("change, irischange",".color-picker",function(c){a.update_theme();c=jQuery(c.currentTarget);c.hasClass("background-color")&&c.parents("table").find(".background-opacity").show()})},update_theme:function(){var a=jQuery("[name^='popup_theme_']").serializeArray(),c={},b;for(b=0;a.length>b;b+=1)0===a[b].name.indexOf("popup_theme_")&&(c[a[b].name.replace("popup_theme_","")]=a[b].value);this.retheme_popup(c)}, theme_preview_scroll:function(){var a=jQuery("#popmake-theme-editor .empreview, body.post-type-popup_theme form#post #popmake_popup_theme_preview"),c=a.parent(),b=a.offset().top-50;jQuery(window).on("scroll",function(){jQuery("> .postbox:visible",c).index(a)===jQuery("> .postbox:visible",c).length-1&&jQuery(window).scrollTop()>=b?a.css({left:a.offset().left,width:a.width(),height:a.height(),position:"fixed",top:50}):a.removeAttr("style")})},initialize_theme_page:function(){jQuery("#popuptitlediv").insertAfter("#titlediv"); var a=jQuery("#popup_theme_close_location").parents("table");this.update_theme();this.theme_page_listeners();this.theme_preview_scroll();jQuery("select.border-style").each(function(){var a=jQuery(this);"none"===a.val()?a.parents("table").find(".border-options").hide():a.parents("table").find(".border-options").show()});jQuery(".color-picker.background-color").each(function(){var a=jQuery(this);""===a.val()?a.parents("table").find(".background-opacity").hide():a.parents("table").find(".background-opacity").show()}); jQuery("tr.topleft, tr.topright, tr.bottomleft, tr.bottomright",a).hide();switch(jQuery("#popup_theme_close_location").val()){case "topleft":jQuery("tr.topleft",a).show();break;case "topright":jQuery("tr.topright",a).show();break;case "bottomleft":jQuery("tr.bottomleft",a).show();break;case "bottomright":jQuery("tr.bottomright",a).show()}},retheme_popup:function(a){var c=jQuery(".empreview .example-popup-overlay"),b=jQuery(".empreview .example-popup"),e=jQuery(".title",b),f=jQuery(".content",b),d= jQuery(".close-popup",b),g="yes"===a.container_boxshadow_inset?"inset ":"",h="yes"===a.close_boxshadow_inset?"inset ":"";c.removeAttr("style").css({backgroundColor:this.convert_hex(a.overlay_background_color,a.overlay_background_opacity)});b.removeAttr("style").css({padding:a.container_padding+"px",backgroundColor:this.convert_hex(a.container_background_color,a.container_background_opacity),borderStyle:a.container_border_style,borderColor:a.container_border_color,borderWidth:a.container_border_width+ "px",borderRadius:a.container_border_radius+"px",boxShadow:g+a.container_boxshadow_horizontal+"px "+a.container_boxshadow_vertical+"px "+a.container_boxshadow_blur+"px "+a.container_boxshadow_spread+"px "+this.convert_hex(a.container_boxshadow_color,a.container_boxshadow_opacity)});e.removeAttr("style").css({color:a.title_font_color,fontSize:a.title_font_size+"px",fontFamily:a.title_font_family,textAlign:a.title_text_align,textShadow:a.title_textshadow_horizontal+"px "+a.title_textshadow_vertical+ "px "+a.title_textshadow_blur+"px "+this.convert_hex(a.title_textshadow_color,a.title_textshadow_opacity)});f.removeAttr("style").css({color:a.content_font_color,fontFamily:a.content_font_family});d.html(a.close_text).removeAttr("style").css({padding:a.close_padding+"px",backgroundColor:this.convert_hex(a.close_background_color,a.close_background_opacity),color:a.close_font_color,fontSize:a.close_font_size+"px",fontFamily:a.close_font_family,borderStyle:a.close_border_style,borderColor:a.close_border_color, borderWidth:a.close_border_width+"px",borderRadius:a.close_border_radius+"px",boxShadow:h+a.close_boxshadow_horizontal+"px "+a.close_boxshadow_vertical+"px "+a.close_boxshadow_blur+"px "+a.close_boxshadow_spread+"px "+this.convert_hex(a.close_boxshadow_color,a.close_boxshadow_opacity),textShadow:a.close_textshadow_horizontal+"px "+a.close_textshadow_vertical+"px "+a.close_textshadow_blur+"px "+this.convert_hex(a.close_textshadow_color,a.close_textshadow_opacity)});switch(a.close_location){case "topleft":d.css({top:a.close_position_top+ "px",left:a.close_position_left+"px"});break;case "topright":d.css({top:a.close_position_top+"px",right:a.close_position_right+"px"});break;case "bottomleft":d.css({bottom:a.close_position_bottom+"px",left:a.close_position_left+"px"});break;case "bottomright":d.css({bottom:a.close_position_bottom+"px",right:a.close_position_right+"px"})}jQuery(document).trigger("popmake-admin-retheme",[a])},serialize_form:function(a){var c={};jQuery("[name]",a).each(function(){var a=jQuery(this).attr("name"),e=jQuery(this).val(), a=a.split("["),f=c,d,g=a.length,h;for(d=0;d<g;d+=1)h=a[d].replace("]",""),f[h]||(f[h]={}),d!==a.length-1?f=f[h]:d===a.length-1&&(f[h]=e)});return c},convert_hex:function(a,c){a=a.replace("#","");var b=parseInt(a.substring(0,2),16),e=parseInt(a.substring(2,4),16),f=parseInt(a.substring(4,6),16);return"rgba("+b+","+e+","+f+","+c/100+")"},debounce:function(a,c){var b;return function(){var e=this,f=arguments;window.clearTimeout(b);b=window.setTimeout(function(){a.apply(e,f)},c)}},throttle:function(a, c){var b=!1,e=function(){b=!1};return function(){b||(a(),window.setTimeout(e,c),b=!0)}}};jQuery(document).ready(function(){PopMakeAdmin.init()})})();